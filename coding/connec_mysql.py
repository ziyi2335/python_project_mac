#!/usr/bin/env python# -*- coding: utf-8 -*-# @Time    : 2018/5/26 ä¸‹åˆ10:50# @Author  : ziyi# @File    : connec_mysql.py# @Software: PyCharmimport pymysql# åˆ›å»ºæ•°æ®åº“def cre_db(host, user, pw, name):    try:        # æ•°æ®åº“è¿æ¥        db = pymysql.connect(host, user, pw, use_unicode=True, charset='utf8')        # åˆ›å»ºæ¸¸æ ‡ï¼Œé€šè¿‡è¿æ¥ä¸æ•°æ®é€šä¿¡        cursor = db.cursor()        # æ‰§è¡Œsqlè¯­å¥        cursor.execute('show databases')        rows = cursor.fetchall()        for row in rows:            tmp = "{}".format(row)            print(tmp)        if name in rows:            print('æ•°æ®åº“å·²ç»å­˜åœ¨')            # cursor.execute('drop database if exists ' + name)        else:            print('å¼€å§‹åˆ›å»ºæ•°æ®åº“')            cursor.execute('create database if not exists ' + name)            # æäº¤åˆ°æ•°æ®åº“æ‰§è¡Œ            db.commit()    except pymysql.Error as e:        print("Mysql Error {}: {}".format(e.args[0], e.args[1]))    finally:        # å…³é—­æ•°æ®åº“è¿æ¥        db.close()def create_table(db_host, db_user, db_password, db_database):    try:        db = pymysql.connect(db_host, db_user, db_password, db_database, use_unicode=True, charset='utf8mb4')        cursor = db.cursor()        cursor.execute('DROP TABLE IF EXISTS user_infor')        create_sql = """CREATE TABLE user_infor (roomname CHAR(255), id CHAR(255) NOT NULL, nickname CHAR(255),         province CHAR(255),city CHAR(255), SEX CHAR (4),PRIMARY KEY (id))"""        cursor.execute(create_sql)        # å…³é—­æ•°æ®åº“è¿æ¥        db.close()    except Exception as e:        print(e)def create_table1(db_host, db_user, db_password, db_database,table_name):    try:        db = pymysql.connect(db_host, db_user, db_password, db_database, use_unicode=True, charset='utf8')        cursor = db.cursor()        # cursor.execute('DROP TABLE IF EXISTS {}'.format(table_name))        create_sql = """CREATE TABLE {} (roomname CHAR(255), id CHAR(255) NOT NULL, nickname CHAR(255),         province CHAR(255),city CHAR(255), SEX CHAR (4)) """.format(table_name)        cursor.execute(create_sql)        print('æ–°å»ºæ•°æ®è¡¨æˆåŠŸ')        # å…³é—­æ•°æ®åº“è¿æ¥        db.close()    except Exception as e:        print(e)def insert_data1(db_host, db_user, db_password, db_database,table_name):    db = pymysql.connect(db_host, db_user, db_password, db_database, use_unicode=True, charset='utf8mb4')    cursor = db.cursor()    insert_sql = """INSERT INTO {}(roomname,            id, nickname, province, city,SEX) VALUES ('nus ç§‹å­£ç¾¤', '@a31e92631c6586917965e3e7cf5c9d475a4e3311',             'çˆ±åƒç•ªèŒ„çš„å¾é›ªå‡¡ğŸ…', 'æ±Ÿè‹','å—äº¬', '0')""".format(table_name)    try:        # æ‰§è¡Œsqlè¯­å¥        cursor.execute(insert_sql)        print('æ’å…¥æ•°æ®')        # æäº¤åˆ°æ•°æ®åº“æ‰§è¡Œ        db.commit()    except Exception as e:        # å¦‚æœå‘ç”Ÿé”™è¯¯åˆ™å›æ»š        print('æ²¡æœ‰æ’å…¥æ•°æ®,å¯èƒ½æœ‰é‡å¤',e)        db.rollback()    db.close()    # sql ="""ALTER TABLE user_infor CONVERT TO CHARACTER SET utf8mb4"""    # cursor.execute(sql)    # print('ä¿®æ”¹ç¼–ç ')    # # æäº¤åˆ°æ•°æ®åº“æ‰§è¡Œ    # db.commit()if __name__ == '__main__':    db_host = 'localhost'    db_user = 'root'    db_password = 'woaini36588'    db_database = 'userdb'    table_name = 'all_user'    # cre_db(db_host, db_user, db_password, db_database)    # æ–°å»ºè¡¨    create_table1(db_host, db_user, db_password, db_database, table_name)    insert_data1(db_host, db_user, db_password, db_database, table_name)