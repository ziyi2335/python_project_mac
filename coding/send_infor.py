#!/usr/bin/env python# -*- coding: utf-8 -*-# @Time    : 2018/7/28 上午9:34# @Author  : ziyi# @File    : send_infor.py# @Software: PyCharm#!/usr/bin/python# -*- coding: utf-8 -*-__author__ = 'ziyi'import itchatimport timeimport datetimedef SentChatRoomsMsg(send_contents,send_img):    chatrooms = itchat.get_chatrooms(update=True)    print('手机中的群聊数目为：', len(chatrooms))    j = 0    news_path = '/Users/lvzeqin/python_project/data/chatrooms/chat_news_origin.txt'    news_contents = get_contents(news_path)    print(news_contents)    for i, one_name in enumerate(chatrooms):        name = one_name['NickName']        if '大数据' in name \                or '学习' in name \                or '交流' in name \                or '数据分析与应用' in name \                or '内推' in name \                or '高级研修' in name \                or '南大脱单' in name \                or '魔法学院' in name \                or '求职' in name \                or '南京地产' in name \                or '职场有道' in name \                or '实习' in name \                or '校园招聘' in name \                or '高校学联' in name \                or '数据挖掘' in name \                or '名企' in name \                or '南京创业资源' in name\                or '秋招' in name\                or '备战' in name:            if '公安' not in name and '栖霞' not in name and '中国创业实习' not in name and '南大 大数据' not in name and '苏州市' not in\                    name and '数据家' \                    not in name and 'edu' not\                    in\                    name and '微商交流' not \                    in name and '哈希大数据' != \                    name.replace(' ', ''):                searchName = name                iRoom = itchat.search_chatrooms(searchName)                j = j + 1                for room in iRoom:                    if room['NickName'] == searchName:                        userName = room['UserName']                        print(j, i, room['NickName'])                        # 实现发送消息的功能                        itchat.send_msg(news_contents, userName)                        # print(send_img)                        # itchat.send_image(send_img, toUserName=userName)                        print(userName, '发送成功')                        time.sleep(3)        # if '相亲相爱' in name:        #     searchName = name        #     iRoom = itchat.search_chatrooms(searchName)        #     for room in iRoom:        #         if room['NickName'] == searchName:        #             userName = room['UserName']        #             print(j, i, room['NickName'])        #             # 实现发送消息的功能        #             itchat.send_msg(news_contents, userName)        #             itchat.send_image(send_img, toUserName=userName)        #             print(userName, '发送成功')        #             time.sleep(2)def get_contents(path):    send_contents = None    try:        with open(path, encoding='utf16') as f:            contents = f.readlines()        send_contents = ''.join(content.replace('\xa0', '').replace(' ', '') for content in contents)    except Exception as e:        pass    try:        with open(path, encoding='utf8') as f:            contents = f.readlines()        send_contents = ''.join(content.replace('\xa0', '').replace(' ', '') for content in contents)    except Exception as e:        print('不是utf8的编码格式')    return send_contentsdef get_contents1(path):    # 取消替换空格    send_contents = None    try:        with open(path, encoding='utf16') as f:            contents = f.readlines()        send_contents = ''.join(content for content in contents)    except Exception as e:        pass    try:        with open(path, encoding='utf8') as f:            contents = f.readlines()        send_contents = ''.join(content for content in contents)    except Exception as e:        print('不是utf8的编码格式')    return send_contentsif __name__ == '__main__':    # itchat.auto_login ()    itchat.auto_login(hotReload=True)  # 首次扫描登录后后续直接确认登录，无需再扫描    path = '../data/chatrooms/chat_news_origin.txt'    img_path = "/Users/lvzeqin/python_project/data/img/2.jpg"  # 图片地址    check_word = input('请输入此时要跑的内容case or news: ')    nowtime = datetime.datetime.now()    print(nowtime)#     测试群名称# news 发送64个群    send_contents = get_contents(path)    # send_img = get_contents1(img_path)    SentChatRoomsMsg(send_contents, img_path)    print(send_contents, img_path)